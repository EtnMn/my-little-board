@page "/"
@inject ISender sender
@inject IDialogService Dialog

@using Etn.MyLittleBoard.Application.Projects.Create
@using Etn.MyLittleBoard.Domain.Aggregates.Projects
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>My Little Board</PageTitle>

<AuthorizeView>
    @* <h1>Hello @context.User.Identity?.Name!</h1> *@
    <MudToolBar Class="justify-end" WrapContent="true" Gutters="false">
        <AuthorizeView Roles="@Role.Administrator" Context="innerContext">
            <Authorized>
                @* <p>You're an @(innerContext.User.Claims.FirstOrDefault(c => c.Type == Claim.Role)?.Value)!</p> *@
                <MudButton StartIcon="@Icons.Material.Filled.CreateNewFolder" Color="Color.Primary" Variant="Variant.Filled" @onclick="@(() => CreateProject())">New</MudButton>
            </Authorized>
        </AuthorizeView>
    </MudToolBar>   
</AuthorizeView>

@code {
    private async Task CreateProject()
    {
        IDialogReference dialog = await Dialog.ShowAsync<CreateProjectDialog>(
            "Create a new project",
            new DialogOptions() {
                MaxWidth = MaxWidth.Medium,
                CloseButton = true
            }
        );

        DialogResult? dialogResult = await dialog.Result;
        if (dialogResult is not null && !dialogResult.Canceled && dialogResult.Data is CreateProjectRequest createProjectRequest)
        {
            Result<ProjectId> result = await sender.Send(createProjectRequest);
            Console.WriteLine(result.Value);
        }        
    }
}
